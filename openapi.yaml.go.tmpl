{{- define "proto" -}}
{{- $type := dict }}
{{- set $type "null" "null" -}}
{{- set $type "any" "object" -}}
{{- set $type "byte" "string" -}}
{{- set $type "bool" "boolean" -}}
{{- set $type "uint" "number" -}}
{{- set $type "uint8" "number" -}}
{{- set $type "uint16" "number" -}}
{{- set $type "uint32" "number" -}}
{{- set $type "uint64" "number" -}}
{{- set $type "int" "number" -}}
{{- set $type "int8" "number" -}}
{{- set $type "int16" "number" -}}
{{- set $type "int32" "number" -}}
{{- set $type "int64" "number" -}}
{{- set $type "float32" "number" -}}
{{- set $type "float64" "number" -}}
{{- set $type "string" "string" -}}
{{- set $type "timestamp" "string" -}}
{{- set $type "map" "object" -}}
{{- set $type "[]" "array" -}}

# {{.Name}} {{.SchemaVersion}} {{.SchemaHash}}
# --
# This file has been generated by webrpc-gen VERSION COMMAND
# Do not edit by hand. Update your webrpc schema and re-generate.
openapi: 3.0.0
info:
  title: {{(index .Services 0).Name}} API
  version: vTODO
components:
  schemas:
    empty:
      type: object
    error:
      properties:
        error:
          type: string
    {{- range $i, $msg := .Messages}}
    {{template "message" dict "Message" $msg "TypeDict" $type }}
    {{- end -}}
    {{- range .Services}}
    {{- range $i, $method := .Methods}}
    {{$method.Name}}_Request:
      {{if gt (len .Inputs) 0}}properties:{{else}}type: object{{end}}
      {{- range $i, $input := .Inputs}}
        {{.Name}}:
          {{ template "fieldType" dict "Type" .Type "TypeDict" $type "Indent" "          " }}
      {{- end -}}
    {{- end -}}
    {{- range $i, $method := .Methods}}
    {{$method.Name}}_Response:
      {{if gt (len .Outputs) 0}}properties:{{else}}type: object{{end}}
      {{- range $i, $output := .Outputs}}
        {{.Name}}:
          {{ template "fieldType" dict "Type" .Type "TypeDict" $type "Indent" "          " }}
        {{- end -}}
      {{- end -}}
    {{- end -}}

{{- range .Services -}}
{{- $serviceName:=.Name}}

paths:
  {{- range $i, $method := .Methods}}
  /rpc/{{$serviceName}}/{{.Name}}:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/{{$method.Name}}_Request'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{$method.Name}}_Response'
        default:
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/error'
  {{- end -}}
{{- end -}}
{{- end -}}
